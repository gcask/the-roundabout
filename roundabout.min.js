function showPlayer(t){return State.isHighlighted(t)?m("mark",t):t}let State={teams:[],ones:[],twos:[],highlighted:"(none)",load:function(t){return m.request({method:"GET",url:t}).then(function(t){State.teams=t.teams,State.ones=t.ones,State.twos=t.twos})},isHighlighted:t=>State.highlighted==t,highlight:function(t){State.highlighted=t}};const trophyIcon=()=>m.trust("&#x1F3C6;"),Standings={view:function(t){const e={ONES:9,TWOS:5,THREES:45};let s=State.teams.map(t=>({members:t.members,ones:0,twos:0,threes:0,total:function(){return this.ones+this.twos+this.threes}}));for(const t of State.ones)for(const m of t)if("score"in m){let t=m.players[m.score[0]>m.score[1]?0:1];const o=s.findIndex(e=>e.members.includes(t));s[o].ones+=e.ONES}for(const t of State.twos){let m=t.pairs[t.score[0]>t.score[1]?0:1][0];const o=s.findIndex(t=>t.members.includes(m));s[o].twos+=e.TWOS}s.sort((t,e)=>{const s=t.total(),m=e.total();return s==m?t.threes==e.threes?t.twos==e.twos?t.ones<e.ones:t.twos<e.twos:e.threes<t.threes:s<m});let o=0,n=0,r=0;return s.forEach((t,e)=>{t.ones>s[o].ones&&(o=e),t.twos>s[n].twos&&(n=e),t.threes>s[r].threes&&(r=e)}),m(".column",m("table.table.table-striped.table-hover",[m("thead",m("tr",[m("th",{colspan:4},"Team"),m("th.text-right","1v1"),m("th.text-right","2v2"),m("th.text-right","3v3"),m("th.text-right","Total")])),m("tbody",s.map((t,e)=>m("tr",m("td",0==e?m("strong",trophyIcon(),e+1):e+1),t.members.map(t=>m("td",showPlayer(t))),m("td.text-right",e==o&&t.ones>0?m("strong",trophyIcon(),t.ones):t.ones),m("td.text-right",e==n&&t.twos>0?m("strong",trophyIcon(),t.twos):t.twos),m("td.text-right",e==r&&t.threes>0?m("strong",trophyIcon(),t.threes):t.threes),m("td.text-right",0==e?m("strong",trophyIcon(),t.total()):t.total())))),m("caption",m("h1","Standings"))]))}},Team={view:function(t){return m(".card.team",[m(".card-header",m("h2.card-title",showPlayer(t.attrs.members[0]))),m("ul.card-body",t.attrs.members.slice(1).map(t=>m("li",showPlayer(t)))),m(".card-footer")])}},Teams={view:function(t){return[m("section.columns",State.teams.map(t=>m(".column.col-lg-3.col-md-6.col-sm-12",m(Team,t)))),m("section.columns",m(Standings))]}},Threes={view:function(t){const e=State.teams.slice(1),s=State.teams.slice(0,-1);return m(".columns",[m(".column",[m("table.table",[m("caption",m("h2","First Bo3")),m("thead.text-center",m("tr",[m("th"),s.map(t=>m("th",showPlayer(t.members[0])))])),m("tbody",e.map((t,e)=>m("tr",[m("th",showPlayer(t.members[0])),s.map((t,s)=>m("td",{class:e<s?"bg-gray":""}))])))])])])}},Twos={view:function(t){const e=[[0,1],[0,2],[1,2]],s=State.teams.slice(1),o=State.teams.slice(0,-1);return m(".columns",[m(".column.col-12",[m("table.table.table-scroll",[m("caption",m("h2","Round-robin Bo3")),m("thead.text-center",m("tr",[m("th",{colspan:2}),o.map(t=>m("th",{colspan:3},["Team ",showPlayer(t.members[0])]))]),m("tr",[m("th",{colspan:2}),o.map(t=>e.map(e=>m("th",[showPlayer(t.members[e[0]])," ",showPlayer(t.members[e[1]])])))])),s.map((t,s)=>m("tbody",e.map((n,r)=>{let a=[];const i=t.members[n[0]],c=t.members[n[1]];return 0==r&&a.push(m("th",{rowspan:3},["Team ",showPlayer(i)])),a.push(m("th",[showPlayer(i)," ",showPlayer(c)])),a.push(...o.map((t,o)=>e.map(e=>{const n=t.members[e[0]],r=t.members[e[1]];let a=void 0,l=-1,h=-1;const u=()=>s<o?{class:"bg-gray"}:[i,c,n,r].some(State.isHighlighted)?{class:"bg-secondary text-center"}:{class:"text-center"};if(s>=o){const t=[i,c,n,r];a=State.twos.find(e=>e.pairs.flat().every(e=>t.includes(e))),a&&(l=a.pairs.findIndex(t=>t.includes(i)),h=(l+1)%2)}return m("td",u(),a?a.score[l]+" - "+a.score[h]:"")}))),m("tr",a)})))])])])}},Ones={view:function(t){return m(".columns",[m(".column.col-12",[m("table.table.table-striped",[m("thead",[m("tr",[m("th"),State.ones.map((t,e)=>m("th.text-center",{colspan:2},"Round "+(e+1)))]),m("tr",[m("th","Player"),State.ones.map(()=>[m("th.text-center","Opponent"),m("th.text-center","Result")])])]),m("tbody",State.teams.map(t=>[t.members.map(t=>m("tr",State.isHighlighted(t)?{class:"bg-secondary"}:{},[m("td",showPlayer(t)),State.ones.map(e=>{const s=e.find(e=>e.players.includes(t)),o=s.players.indexOf(t),n=(o+1)%2;return[m("td.text-center",showPlayer(s.players[n])),m("td.text-center","score"in s?s.score[o]+" - "+s.score[n]:"")]})]))]))])])])}},App={oninit:function(t){State.load(t.attrs.dataUrl)},view:function(t){const e=function(t){return State.isHighlighted(t)?{value:t,selected:!0}:{value:t}},s=function(t){return{class:"btn-lg btn btn-"+(m.route.get()==t?"primary":"link"),href:t}};return[m("header.navbar",[m("section.navbar-section",[m("strong.navbar-brand.mr-2","The Roundabout"),m(m.route.Link,s("/teams"),"Teams")]),m("section.navbar-center",[m(m.route.Link,s("/3s"),"3v3"),m(m.route.Link,s("/2s"),"2v2"),m(m.route.Link,s("/1s"),"1v1")]),m("section.navbar-section",[m(".input-group.input-inline",[m("select.form-select",{onchange:function(t){State.highlight(t.target.value)}},[m("option",e("(none)"),"(no player highlighted)"),State.teams.map(t=>t.members.map(t=>m("option",e(t),t)))])])])]),m(".container",t.children)]}};